apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: deviceconfigs.netops.example.com
spec:
  group: netops.example.com
  scope: Namespaced
  names:
    plural: deviceconfigs
    singular: deviceconfig
    kind: DeviceConfig
    shortNames:
      - dc
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          required: ["spec"]
          properties:
            spec:
              type: object
              required: ["deviceRef", "intent"]
              properties:
                deviceRef:
                  type: object
                  required: ["name"]
                  properties:
                    name:
                      type: string
                      description: "Target NetworkDevice name."
                    namespace:
                      type: string
                      description: "Optional device namespace (default: same namespace)."
                intent:
                  type: object
                  description: "Desired config intent (schema-validated later)."
                  x-kubernetes-preserve-unknown-fields: true
                dryRun:
                  type: boolean
                  default: false
                  description: "Validate only (do not apply)."
            status:
              type: object
              properties:
                observedGeneration:
                  type: integer
                appliedRevision:
                  type: string
                  description: "Opaque revision/hash identifying what was applied."
                lastAppliedTime:
                  type: string
                  format: date-time
                phase:
                  type: string
                  enum: ["pending", "applying", "applied", "error", "drift"]
                message:
                  type: string
                lastError:
                  type: object
                  properties:
                    code:
                      type: string
                    detail:
                      type: string
